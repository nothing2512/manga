<html>

<head>
    <title>List Manga</title>

    <link rel="stylesheet" href='/fonts/fonts.css'>
    <link rel="stylesheet" href='/vendor/nucleo/css/nucleo.css'>
    <link rel="stylesheet" href='/vendor/@fortawesome/fontawesome-free/css/all.min.css'>
    <link rel="stylesheet" href='/css/argon.css?v=1.1.0'>

    <script>
        const isDarkTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const linkElement = document.createElement('link');
        linkElement.setAttribute('rel', 'icon');
        linkElement.setAttribute('type', 'image/x-icon')
        linkElement.setAttribute('href', isDarkTheme ? '/favicon-light.png' : '/favicon-dark.png');
        document.head.appendChild(linkElement);
    </script>

    <style>
        .icon {
            width: 24px;
            height: 24px;
        }
        .icon-container:hover path {
            fill: #ffffff;
        }
    </style>

    <style>
        .title {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .card-body {
            padding: 0 !important;
        }

        .card {
            overflow: hidden;
        }

        .read-btn {
            border-top-right-radius: 0 !important;
            border-top-left-radius: 0 !important;
        }
    </style>

    <script src="//unpkg.com/alpinejs"></script>
    <script>
        Alpine.data('data', () => ({
            init() {
                fetch("/api/list").then(data => data.json()).then(data => {
                    for (let i in data) {
                        data[i].lastUpdated = this.getTimer(data[i].lastUpdated)
                    }
                    this.mangas = data
                })
            },
            shown(manga) {
                let sameName = manga.name.toLowerCase().includes(this.search.toLowerCase())
                let onState = false;

                if (this.state == 'a') onState = true;
                else if (this.state == 'r') onState = manga.lastRead == manga.index;
                else if (this.state == 'u') onState = manga.lastRead < manga.index;

                return sameName && onState;
            },
            getTimer(d) {
                let date = new Date(d)
                let now = new Date()
                let diff = Math.floor((now - date) / (1000 * 60 * 60));
                
                if (diff < 24) return `${diff}h`
                diff = Math.floor(diff/24)

                if (diff < 7) return `${diff}d`
                diff = Math.floor(diff/7)

                if (diff < 4) return `${diff}w`
                diff = Math.floor(diff/4)

                if (diff < 12) return `${diff}m`
                diff = Math.floor(diff/12)

                return `${diff}y`
            },
            mangas: [],
            search: "",
            state: "a"
        }))
    </script>
</head>

<body x-data="data">
    <div class="g-sidenav-show g-sidenav-pinned bg-dark">
        <div class="main-content">
            <section class="section section-lg pt-5">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-12">
                            <div class="row justify-content-center px-2">
                                <div class="col-12 col-lg-1">
                                    <div class="form-group">
                                        <a href="/" class="btn btn-outline-primary icon-container">
                                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                <path
                                                    d="M21 19.9997C21 20.552 20.5523 20.9997 20 20.9997H4C3.44772 20.9997 3 20.552 3 19.9997V9.48882C3 9.18023 3.14247 8.88893 3.38606 8.69947L11.3861 2.47725C11.7472 2.19639 12.2528 2.19639 12.6139 2.47725L20.6139 8.69947C20.8575 8.88893 21 9.18023 21 9.48882V19.9997ZM19 18.9997V9.97791L12 4.53346L5 9.97791V18.9997H19Z"
                                                    fill="#5e72e4"></path>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                                <div class="col-12 col-lg-7">
                                    <div class="form-group">
                                        <input class="form-control" placeholder="Search" type="text" x-model="search">
                                    </div>
                                </div>
                                <div class="col-12 col-lg-4">
                                    <div class="form-group">
                                        <select class="form-control" data-toggle="select" x-model="state">
                                            <option selected value="a">All</option>
                                            <option value="r">Readed</option>
                                            <option value="u">UnReaded</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">

                                <template x-for="manga in mangas">
                                    <template x-if="shown(manga)">

                                        <div class="col-lg-3 col-6 col-md-12 p-4">
                                            <a x-bind:href="`/read?id=${manga.id}&page=${manga.lastRead}`">
                                                <img x-bind:src="manga.image"
                                                    style="width: 100%; height: 325px; object-fit: cover; border-radius: .375rem;"
                                                    referrerpolicy="no-referrer">
                                                <div class="pt-3">
                                                    <h3 class="mb-0 text-secondary text-uppercase"
                                                        style="display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;"
                                                        x-text="manga.name"></h3>
                                                    <div style="display: flex; justify-content: space-between;">
                                                        <span style="color: #8ca1cb; font-weight: 500; font-size: 10pt;" x-text="`Progress ${manga.lastRead} / ${manga.index}`"></span>
                                                        <span style="color: #8ca1cb; font-weight: 500; font-size: 10pt;" x-text="`${manga.lastUpdated} ago`"></span>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </template>
                                </template>

                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <footer class="py-5" id="footer-main">
            <div class="container">
                <div class="row align-items-center justify-content-xl-between">
                    <div class="col-xl-6">
                        <div class="copyright text-center text-xl-left text-muted">
                            Â© 2019 <a href="https://www.creative-tim.com" class="font-weight-bold ml-1"
                                target="_blank">Creative Tim</a>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <ul class="nav nav-footer justify-content-center justify-content-xl-end">
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com" class="nav-link" target="_blank">Creative Tim</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com/presentation" class="nav-link"
                                    target="_blank">About Us</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://blog.creative-tim.com" class="nav-link" target="_blank">Blog</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com/license" class="nav-link"
                                    target="_blank">License</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src='/vendor/js-cookie/js.cookie.js'></script>
    <script src='/vendor/jquery.scrollbar/jquery.scrollbar.min.js'></script>
</body>

</html>
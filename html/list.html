<html>

<head>
    <title>List Manga</title>

    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href='/fonts/fonts.css'>
    <link rel="stylesheet" href='/vendor/nucleo/css/nucleo.css'>
    <link rel="stylesheet" href='/vendor/@fortawesome/fontawesome-free/css/all.min.css'>
    <link rel="stylesheet" href='/css/argon.css?v=1.1.0'>
    <link rel="stylesheet" href='/vendor/select2/dist/css/select2.min.css'>

    <style>
        .title {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        .card-body {
            padding: 0 !important;
        }
        .card {
            overflow: hidden;
        }
        .read-btn {
            border-top-right-radius: 0 !important;
            border-top-left-radius: 0 !important;
        }
    </style>

    <script src="//unpkg.com/alpinejs"></script>
    <script>
        Alpine.data('data', () => ({
            init() {
                fetch("/api/list").then(data => data.json()).then(data => this.mangas = data)
            },
            shown(manga) {
                let sameName = manga.name.toLowerCase().includes(this.search.toLowerCase())
                let onState = false;

                if (this.state == 'a') onState = true;
                else if (this.state == 'r') onState = manga.lastRead == manga.index;
                else if (this.state == 'u') onState = manga.lastRead < manga.index;

                return sameName && onState;
            },
            mangas: [],
            search: "",
            state: "a"
        }))
    </script>
</head>

<body x-data="data">
    <div class="g-sidenav-show g-sidenav-pinned">
        <div class="main-content">
            <section class="py-6 pb-9 bg-default">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-1">
                            <div class="form-group">
                                <a href="/" class="btn btn-outline-white">BACK</a>
                            </div>
                        </div>
                        <div class="col-12 col-lg-7">
                            <div class="form-group">
                                <input class="form-control" placeholder="Search" type="text" x-model="search">
                            </div>
                        </div>
                        <div class="col-12 col-lg-4">
                            <div class="form-group">
                                <select class="form-control" data-toggle="select" x-model="state">
                                    <option selected value="a">All</option>
                                    <option value="r">Readed</option>
                                    <option value="u">UnReaded</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="section section-lg pt-lg-0 mt--7">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-12">
                            <div class="row">

                                <template x-for="manga in mangas">
                                    <template x-if="shown(manga)">

                                        <div class="col-lg-2">
                                            <div class="card card-lift--hover shadow border-0">
                                                <div class="card-body" style="border-radius: .375rem;padding: 0 !important;">
                                                    <img x-bind:src="manga.image" style="width: 100%; height: 250px; object-fit: cover; border-radius: .375rem .375rem 0 0;" referrerpolicy="no-referrer">
                                                    <div class="p-3">
                                                        <a x-bind:href="`/read?id=${manga.id}&page=${manga.lastRead}`">
                                                            <h4 class="h3 text-primary text-uppercase"
                                                                style="display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;"
                                                                x-text="manga.name"></h4>
                                                        </a>
                                                        <div>
                                                            <!--                                                <span class="badge badge-pill badge-primary" v-for="genre in manga.genres">{{ genre }}</span>-->
                                                        </div>
                                                    </div>
                                                    <a 
                                                        x-bind:href="`/read?id=${manga.id}&page=${manga.lastRead}`"
                                                        x-bind:class="manga.index == manga.lastRead ? 'btn-success' : 'btn-primary'"
                                                        x-text="`Read ${manga.lastRead} / ${manga.index}`"
                                                        class="btn w-100 read-btn">
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </template>

                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <footer class="py-5" id="footer-main">
            <div class="container">
                <div class="row align-items-center justify-content-xl-between">
                    <div class="col-xl-6">
                        <div class="copyright text-center text-xl-left text-muted">
                            Â© 2019 <a href="https://www.creative-tim.com" class="font-weight-bold ml-1" target="_blank">Creative Tim</a>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <ul class="nav nav-footer justify-content-center justify-content-xl-end">
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com" class="nav-link" target="_blank">Creative Tim</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com/presentation" class="nav-link" target="_blank">About Us</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://blog.creative-tim.com" class="nav-link" target="_blank">Blog</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com/license" class="nav-link" target="_blank">License</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script src='/vendor/jquery/dist/jquery.min.js'></script>
    <script src='/vendor/bootstrap/dist/js/bootstrap.bundle.min.js'></script>
    <script src='/vendor/js-cookie/js.cookie.js'></script>
    <script src='/vendor/jquery.scrollbar/jquery.scrollbar.min.js'></script>
    <script src='/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js'></script>
    <script src='/vendor/onscreen/dist/on-screen.umd.min.js'></script>
    <script src='/vendor/select2/dist/js/select2.min.js'></script>
    <script src='/js/argon.js?v=1.1.0'></script>
</body>

</html>
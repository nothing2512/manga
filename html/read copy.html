<html>

<head>
    <title>Read Manga</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        .title {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
    </style>
</head>

<body class="bg-dark p-2">

    <script src="//unpkg.com/alpinejs"></script>
    <script>
        Alpine.data('data', () => ({
            init() {
                fetch(`/api/read${location.search}`).then(data => data.json()).then(data => {
                    this.data = data;
                    document.addEventListener('keydown', function (e) {
                        if (e.keyCode == 37 && data.canPrevious) location.href = `/read?id=${data.manga.id}&page=${data.page - 1}`
                        if (e.keyCode == 39 && data.canNext) location.href = `/read?id=${data.manga.id}&page=${data.page + 1}`
                    });

                    if (data.canNext) {
                        console.log("Can Next")
                        document.getElementById("nextBtn").addEventListener('click', function () {
                            console.log("Can Next")
                            location.href = `/read?id=${data.manga.id}&page=${data.page + 1}`
                        })
                    } else {
                        document.getElementById("nextBtn").disabled = true;
                    }

                    if (data.canPrevious) {
                        document.getElementById("prevBtn").addEventListener('click', function () {
                            location.href = `/read?id=${data.manga.id}&page=${data.page - 1}`
                        })
                    } else {
                        document.getElementById("prevBtn").disabled = true;
                    }

                    document.getElementById("deleteBtn").addEventListener('click', function () {
                        if (confirm("Delete ?")) {
                            location.href = `/api/delete?id=${data.manga.id}`
                        }
                    })
                })
            },
            data: {
                "manga": {
                    lastRead: 0,
                    index: 0
                },
                "images": [],
                "canNext": false,
                "canPrevious": false,
                "page": 0
            }
        }))
    </script>

    <div class="align-items-center d-flex flex-column w-100" x-data="data">
        <template x-for="img in data.images">
            <div class="col-6">
                <img x-bind:src="img.link" class="w-100" referrerpolicy="no-referrer">
            </div>
        </template>
        <div style="position: fixed; right: 0; width: 100px; height: 100%"
            class="justify-content-center d-flex flex-column">
            <a href="/" class="p-3 w-100 btn btn-light mb-3">Home</a>
            <a href="/list" class="p-3 w-100 btn btn-light mb-3">List</a>
            <button class="p-3 w-100 btn btn-light mb-3" id="prevBtn">Previous</button>
            <div class="p-3 w-100 btn btn-light mb-3" x-html="`${data.manga.lastRead} / ${data.manga.index}`"></div>
            <button class="p-3 w-100 btn btn-light mb-3" id="nextBtn">Next</button>
            <button class="p-3 w-100 btn btn-light" id="deleteBtn">Delete</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
</body>

</html>